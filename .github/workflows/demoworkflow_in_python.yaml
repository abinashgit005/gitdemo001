name: demoworkflow_in_python
on:
  workflow_dispatch:
  
  push:
    paths:
      - '**/demo.tfvars'

jobs:
  detect-app-rules-changes:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout current repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 2  # Fetch previous commit to compare

      - name: Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y python3-pip
          pip install python-hcl2 deepdiff
      - name: Prepare tfvars comparison
        run: |
          mkdir -p tmp
          git show HEAD~1:demo.tfvars > tmp/old.tfvars || touch tmp/old.tfvars
          cp demo.tfvars tmp/new.tfvars

      - name: Run Python diff script
        id: check
        run: |
          result=$(python3 scripts/check_abinash_app_rules_diff.py | tee /dev/tty)
          echo "$result" | grep "changed=true" && echo "changed=true" >> $GITHUB_OUTPUT || echo "changed=false" >> $GITHUB_OUTPUT
    
